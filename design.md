# 项目设计文档

## 目录结构 
project-root/
├── src/ # 源代码目录
│ ├── components/ # React组件
│ ├── pages/ # 页面组件
│ ├── services/ # API服务
│ ├── utils/ # 工具函数
│ └── App.js # 应用入口
├── public/ # 静态资源
├── tests/ # 测试文件
├── node_modules/ # 依赖包
├── package.json # 项目配置
└── design.md # 设计文档

## 技术栈
- 前端框架：React
- 构建工具：Vite
- 包管理器：npm/yarn
- 代码规范：ESLint + Prettier

## 核心功能模块
1. 用户认证
   - 登录/注册
   - 权限管理

2. 数据管理
   - 数据获取与缓存
   - 状态管理

3. UI组件
   - 布局组件
   - 业务组件
   - 通用组件

## API 接口规范
- 基础URL：`/api/v1`
- 响应格式：
json
{
"code": 200,
"data": {},
"message": "success"
}

## 开发规范
1. 命名规范
   - 组件：PascalCase
   - 文件：kebab-case
   - 变量：camelCase

2. 代码组织
   - 组件按功能模块划分
   - 通用功能抽离为hooks
   - 工具函数集中管理

## 注意事项
- 性能优化
- 错误处理
- 安全性考虑
- 兼容性要求

## 贪吃蛇游戏设计

### 核心功能需求
#### 游戏核心机制
   - 蛇的移动控制
   - 食物生成规则
   - 碰撞检测（边界、自身）
   - 得分系统

##### 游戏核心机制详细设计
1. 蛇的移动机制
   - 速度控制：
     * 初始速度：300ms/移动一次
     * 加速规则：每得100分提升10%速度
     * 最大速度：100ms/移动一次
   - 移动规则：
     * 头部新增一个节点
     * 删除尾部节点
     * 不能直接反向移动
   - 穿墙机制：
     * 当蛇头触碰边界时从对应的另一侧出现
     * 穿墙不影响速度和得分
   - 初始状态：
     * 初始长度：3个单位
     * 初始位置：游戏区域中央
     * 初始方向：向右

2. 食物系统
   - 生成规则：
     * 随机位置生成
     * 不能与蛇身重叠
     * 同时只存在一个食物
   - 食物效果：
     * 蛇长度+1
     * 固定得分+10分

3. 碰撞检测机制
   - 边界碰撞：
     * 启用穿墙模式
     * 从一侧离开时从对侧出现
   - 自身碰撞：
     * 检测蛇头是否与身体重叠
     * 发生碰撞则游戏结束

4. 计分规则
   - 简单计分机制：
     * 每吃到一个食物得10分
     * 无连击加成
     * 无速度加成
   - 分数显示：
     * 实时显示当前分数
     * 记录并显示最高分

5. 游戏状态控制
   - 状态定义：
     * 未开始：显示开始界面
     * 进行中：正常游戏状态
     * 暂停：可暂时停止游戏
     * 结束：显示最终得分和重新开始选项
   - 状态转换：
     * 空格键：开始/暂停
     * 游戏结束后自动显示结算界面

#### 游戏配置
   - 游戏区域大小
   - 移动速度控制
   - 难度级别设置
   - 初始蛇长度

##### 游戏配置详细设计
1. 游戏画布配置
   - 画布尺寸：
     * 宽度：800px
     * 高度：600px
   - 网格系统：
     * 单个网格大小：20px × 20px
     * 横向网格数：40个
     * 纵向网格数：30个
   - 边框样式：
     * 边框宽度：2px
     * 边框颜色：#333333

2. 游戏参数配置
   - 速度配置：
     * 初始移动间隔：300ms
     * 加速比例：每100分提升10%
     * 最小移动间隔：100ms
   - 初始配置：
     * 初始蛇长度：3个单位
     * 初始方向：向右
     * 初始位置：画布中心点

3. 颜色配置
   - 蛇身配置：
     * 蛇头颜色：#4CAF50
     * 蛇身颜色：#81C784
   - 食物配置：
     * 普通食物颜色：#FF5722
   - 背景配置：
     * 画布背景色：#FFFFFF
     * 网格线颜色：#EEEEEE

4. 控制配置
   - 键盘映射：
     * 向上移动：↑ 或 W
     * 向下移动：↓ 或 S
     * 向左移动：← 或 A
     * 向右移动：→ 或 D
     * 暂停/开始：空格键
   - 响应延迟：
     * 按键响应时间：50ms以内

5. 界面配置
   - 计分板：
     * 位置：画布上方
     * 字体大小：24px
     * 字体颜色：#333333
   - 状态提示：
     * 位置：画布中心
     * 字体大小：36px
     * 字体颜色：#000000

6. 存储配置
   - 本地存储项：
     * 最高分记录
     * 游戏设置选项
   - 存储方式：localStorage

#### 交互设计
   - 键盘控制方案
   - 游戏开始/暂停/结束
   - 计分板显示
   - 游戏状态提示

##### 交互设计详细说明
1. 游戏流程交互
   - 开始界面：
     * 显示游戏标题
     * 显示最高分记录
     * 显示"按空格开始游戏"提示
     * 可选的游戏说明
   
   - 游戏进行中：
     * 实时显示当前分数
     * 显示当前速度等级
     * 蛇的移动响应键盘输入
     * 穿墙效果平滑过渡
   
   - 暂停状态：
     * 显示暂停提示
     * 保持当前游戏画面
     * 显示"按空格继续"提示
   
   - 游戏结束：
     * 显示"游戏结束"
     * 显示最终得分
     * 显示最高分记录
     * 显示"按空格重新开始"提示

2. 键盘控制响应
   - 主要控制键：
     * 方向键/WASD：控制移动方向
     * 空格键：开始/暂停/重新开始
     * ESC键：返回主菜单
   
   - 按键限制：
     * 禁止反向移动
     * 移动中按键缓存：保存最后一次有效输入
     * 暂停时禁用方向键

3. 视觉反馈
   - 移动反馈：
     * 蛇头方向指示
     * 移动轨迹平滑
   
   - 得分反馈：
     * 分数增加时数字放大动效
     * 达到加速条件时闪烁提示
   
   - 碰撞反馈：
     * 穿墙时的过渡动画
     * 吃到食物时的特效
     * 游戏结束时的动画效果

4. 状态提示
   - 文字提示：
     * 游戏开始前的操作提示
     * 暂停状态提示
     * 游戏结束提示
   
   - 图标提示：
     * 当前移动方向指示
     * 暂停状态图标
     * 速度等级指示

5. 音效反馈（可选）
   - 基础音效：
     * 移动音效（低音量）
     * 吃到食物音效
     * 游戏结束音效
   
   - 状态音效：
     * 开始游戏音效
     * 暂停/继续音效
     * 加速提示音效

#### 视觉表现
   - 蛇的外观设计
   - 食物的样式
   - 游戏背景
   - 动画效果

##### 视觉表现详细设计
1. 游戏场景设计
   - 背景设计：
     * 主色调：浅色系
     * 网格线：淡灰色细线
     * 边框：深色实线
   - 网格效果：
     * 棋盘格式布局
     * 交错网格颜色略有区分
     * 网格线半透明效果

2. 蛇的视觉设计
   - 蛇头设计：
     * 形状：圆角矩形
     * 颜色：深绿色
     * 特殊标识：小三角形表示方向
   - 蛇身设计：
     * 形状：圆角矩形
     * 颜色：浅绿色
     * 渐变效果：身体节点间略有渐变
   - 移动效果：
     * 平滑过渡动画
     * 转向时的弯曲效果
     * 穿墙时的淡入淡出效果

3. 食物设计
   - 普通食物：
     * 形状：圆形
     * 颜色：红色
     * 效果：轻微的呼吸动画
   - 视觉特效：
     * 生成时的渐现效果
     * 被吃掉时的消失动画
     * 轻微的悬浮效果

4. 界面元素设计
   - 计分板：
     * 位置：顶部居中
     * 字体：无衬线字体
     * 样式：半透明背景衬底
   - 状态提示：
     * 开始/暂停提示：大号字体，居中显示
     * 游戏结束画面：渐变背景遮罩
     * 按键提示：底部小字体显示

5. 动画效果
   - 场景动画：
     * 游戏启动时的淡入效果
     * 状态切换时的转场效果
   - 游戏内动画：
     * 得分时的数字跳动效果
     * 加速时的视觉提示
     * 碰撞时的震动效果
   
6. 配色方案
   - 主要配色：
     * 背景色：#F5F5F5
     * 网格线：#E0E0E0
     * 边框色：#333333
   - 蛇身配色：
     * 蛇头：#4CAF50
     * 蛇身：#81C784
   - 食物配色：
     * 普通食物：#FF5722
   - 文字配色：
     * 主要文字：#333333
     * 提示文字：#757575
     * 得分文字：#2196F3

#### 扩展功能
   - 最高分记录
   - 多人对战模式
   - 特殊食物效果
   - 障碍物系统

##### 扩展功能详细设计

1. 排行榜系统
   - 本地排行榜：
     * 记录最近10次最高分
     * 显示日期和分数
     * 可清空记录
   - 数据存储：
     * 使用 localStorage 存储
     * 记录格式：{date, score, duration}
     * 自动更新排序

2. 游戏模式
   - 经典模式：
     * 基础玩法
     * 穿墙设置
     * 渐进加速
   - 挑战模式：
     * 限时模式：3分钟内获得最高分
     * 障碍物模式：随机生成固定障碍物
     * 迷宫模式：在迷宫中移动
   - 练习模式：
     * 无死亡机制
     * 自由调节速度
     * 适合新手练习

3. 特殊食物系统
   - 食物类型：
     * 普通食物：+1长度，+10分
     * 金色食物：+2长度，+30分
     * 减速食物：临时降低速度10秒
     * 穿墙道具：临时获得穿墙能力
   - 生成规则：
     * 特殊食物出现概率：10%
     * 特殊食物持续时间：10秒
     * 同时最多存在1个特殊食物

4. 成就系统
   - 基础成就：
     * 初次得分：完成第一次游戏
     * 突破100分：单局得分超过100
     * 速度达人：达到最高速度
   - 高级成就：
     * 蛇王：单局得分超过500
     * 持久战：单局游戏超过10分钟
     * 完美主义：吃满整个地图
   - 成就奖励：
     * 解锁特殊皮肤
     * 解锁特殊背景
     * 显示特殊称号

5. 自定义设置
   - 视觉定制：
     * 蛇的皮肤选择
     * 背景主题切换
     * 食物样式选择
   - 游戏参数：
     * 初始速度调节
     * 加速比例调整
     * 网格大小设置
   - 控制设置：
     * 自定义键位
     * 触控支持（可选）
     * 操作灵敏度调节

6. 数据统计
   - 游戏数据：
     * 总游戏次数
     * 总游戏时长
     * 最高分记录
   - 详细统计：
     * 平均得分
     * 最长蛇身记录
     * 食物吃取统计
   - 数据导出：
     * 支持数据备份
     * 支持数据恢复
     * 统计数据导出

### 功能实现优先级

1. 第一阶段 - 核心功能（必须实现）
   - 基础游戏机制：
     * 蛇的移动控制
     * 食物生成系统
     * 碰撞检测
     * 穿墙功能
     * 计分系统
   - 基础视觉效果：
     * 游戏场景渲染
     * 基础动画效果
   - 基础交互：
     * 键盘控制
     * 游戏状态切换

2. 第二阶段 - 重要功能（建议实现）
   - 排行榜系统：
     * 本地记录保存
     * 最高分显示
   - 游戏模式：
     * 经典模式
     * 练习模式
   - 视觉优化：
     * 平滑动画
     * 状态提示
     * 视觉反馈

3. 第三阶段 - 扩展功能（可选实现）
   - 特殊食物系统：
     * 三种特殊食物
     * 概率生成机制
   - 成就系统：
     * 6个基础成就
     * 成就解锁提示
   - 数据统计：
     * 基础游戏数据记录
     * 统计信息显示

### 功能范围限定

1. 特殊食物限制
   - 仅保留三种特殊食物：
     * 普通食物（主要）
     * 金色食物（较少出现）
     * 减速食物（偶尔出现）

2. 游戏模式限制
   - 保留两种模式：
     * 经典模式
     * 练习模式

3. 自定义设置限制
   - 仅保留基础设置：
     * 初始速度调节
     * 音效开关
     * 基础键位设置

4. 成就系统范围
   - 专注于基础成就：
     * 初次得分
     * 突破100分
     * 速度达人
     * 蛇王
     * 持久战
     * 完美主义

### 技术考虑要点
#### 性能优化
   - 渲染效率
   - 碰撞检测算法
   - 状态更新机制

##### 性能优化详细设计
1. 渲染优化
   - Canvas 优化：
     * 使用 requestAnimationFrame 进行渲染
     * 仅在必要时重绘画布
     * 避免频繁的状态切换
   
   - 绘制策略：
     * 双缓冲渲染
     * 仅更新变化的部分
     * 使用离屏 Canvas 预渲染静态元素
   
   - 图层管理：
     * 背景层：静态网格背景
     * 游戏层：蛇和食物
     * UI层：得分和提示信息

2. 碰撞检测优化
   - 数据结构：
     * 使用 Set 存储蛇身坐标
     * 使用网格索引进行快速查找
   
   - 检测算法：
     * 仅检测蛇头周围区域
     * 使用空间分区减少检测范围
     * 缓存上一帧的碰撞结果
   
   - 优化策略：
     * 提前计算碰撞边界
     * 减少不必要的检测

3. 状态管理优化
   - 游戏状态：
     * 使用状态机管理游戏状态
     * 最小化状态切换开销
     * 合理使用状态缓存
   
   - 数据更新：
     * 批量处理状态更新
     * 使用脏标记机制
     * 延迟非关键更新

4. 内存管理
   - 对象池：
     * 复用游戏对象
     * 预分配常用对象
     * 避免频繁创建销毁
   
   - 内存使用：
     * 及时清理不用的对象
     * 避免闭包导致的内存泄漏
     * 控制对象引用数量

5. 事件处理优化
   - 按键响应：
     * 使用事件委托
     * 按键去抖动
     * 优化事件监听器数量
   
   - 事件队列：
     * 合并频繁触发的事件
     * 使用消息队列处理游戏事件
     * 优先处理关键事件

6. 定时器优化
   - 游戏循环：
     * 固定时间步长
     * 使用累加器处理时间误差
     * 平滑处理不规则帧率
   
   - 计时器管理：
     * 集中管理所有计时器
     * 避免嵌套的 setTimeout/setInterval
     * 使用 performance.now() 获取精确时间

#### 游戏体验
   - 流畅度保证
   - 响应速度优化
   - 游戏难度平衡

##### 游戏体验优化详细设计
1. 操作响应优化
   - 按键响应：
     * 输入延迟控制在 16ms 以内
     * 按键缓冲区存储快速输入
     * 防止按键抖动
   
   - 移动控制：
     * 平滑的转向过渡
     * 防止快速反向移动
     * 容错处理（无效输入提示）
   
   - 操作反馈：
     * 即时的视觉反馈
     * 按键提示效果
     * 错误操作提示

2. 游戏节奏控制
   - 速度调节：
     * 平缓的加速曲线
     * 适应性的速度调整
     * 保持可控性的最高速度
   
   - 难度平衡：
     * 合理的初始速度
     * 渐进式的难度提升
     * 适当的奖励机制
   
   - 游戏节奏：
     * 动态的食物生成
     * 合理的游戏区域大小
     * 适当的游戏时长

3. 视觉体验优化
   - 动画过渡：
     * 平滑的移动动画
     * 自然的转向效果
     * 柔和的状态切换
   
   - 视觉反馈：
     * 清晰的得分显示
     * 醒目的状态提示
     * 直观的游戏结果
   
   - 画面效果：
     * 合适的对比度
     * 舒适的配色方案
     * 清晰的游戏元素

4. 容错机制
   - 输入容错：
     * 宽松的按键判定
     * 智能的方向判断
     * 防误触机制
   
   - 游戏容错：
     * 自动暂停机制
     * 状态恢复功能
     * 异常处理提示

5. 游戏节奏
   - 状态转换：
     * 流畅的开始过程
     * 合理的暂停机制
     * 优雅的结束处理
   
   - 游戏流程：
     * 清晰的游戏目标
     * 及时的状态反馈
     * 适当的休息提示

6. 反馈系统
   - 即时反馈：
     * 得分变化提示
     * 速度变化提示
     * 状态切换提示
   
   - 成就反馈：
     * 里程碑提示
     * 记录突破提示
     * 特殊事件提示
